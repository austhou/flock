<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <title>Flock</title>
    <script src="./jquery-3.3.1.js"></script>
</head>
<body>
<h1>flock</h1>
<div id="container">
</div>
<script>

    var element = document.createElement("link");
    element.setAttribute("rel", "stylesheet");
    element.setAttribute("type", "text/css");
    element.setAttribute("href", "./assets/styles.css");
    document.getElementsByTagName("head")[0].appendChild(element);

    var testData = {
        "locations": [
            {
                "devices": [
                    {
                        "device": "Jason B",
                        "timestamp": "2015-08-15T00:04:25.993Z",
                        "probability": 0.98,
                        "randomized": false,
                        "num_scanners": 22,
                        "active_mins": 171,
                        "first_seen": "2015-08-14T23:55:37.334Z"
                    },
                    {
                        "device": "Christina K",
                        "timestamp": "2015-08-15T00:04:25.993Z",
                        "probability": 0.98,
                        "randomized": false,
                        "num_scanners": 22,
                        "active_mins": 171,
                        "first_seen": "2015-08-14T23:55:37.334Z"
                    }
                ],
                "location": "main",
                "gps": {
                    "lat": -1,
                    "lon": -1
                },
                "total": 2
            },
            {
                "devices": [
                    {
                        "device": "Zain S",
                        "timestamp": "2015-08-15T00:04:25.993Z",
                        "probability": 0.98,
                        "randomized": false,
                        "num_scanners": 22,
                        "active_mins": 171,
                        "first_seen": "2015-08-14T23:55:37.334Z"
                    }
                ],
                "location": "backyard",
                "gps": {
                    "lat": -1,
                    "lon": -1
                },
                "total": 2
            }
        ],
        "message": "got locations",
        "success": true
    }

    $(document).ready(() => {
        var request = new XMLHttpRequest()

        //API request
        request.open('GET', 'http://flock.archive.house/find3/api/v1/by_location/archive', true) //GET /api/v1/by_location/FAMILY   http://557ac8e4.ngrok.io/api/v1/locations/testdb
        request.onload = function() {
            var data = JSON.parse(this.response)
            if (request.status >= 200 && request.status < 400) {
                data.locations.forEach(locationObject => {
                    populateLocation(locationObject)
                })
            } else {
                console.log('errorrrrzzz')
            }
        }

        //API unavail
        request.onerror = function() {
            var data = testData;
            data.locations.forEach(locationObject => {
                populateLocation(locationObject)
            })
        };

        request.send()
    })

    function populateLocation(locationObject) {
        console.log(locationObject)
        $('#container').append(`
            <div id='loc${locationObject.location}' class='locationPanel'>
                <div class='${locationObject.location}Icon'></div>
                <p class='locationName'>${locationObject.location}</p>
            </div>
        `);
        locationObject.devices.forEach(deviceObject => {
            $(`#loc${locationObject.location}`).append( `<p>${deviceObject.device}</p>` );
        })
    }

</script>

</body>
</html>